---
- hosts: localhost
  become: yes

  tasks:

    - name: net-tools installed for debugging
      apt:
        name: net-tools
        state: present
        update_cache: yes

    - name: nginx installed
      apt:
        name: nginx
        state: present
        update_cache: yes

    - name: nginx configuration copied
      copy:
        src: nginx.conf
        dest: /etc/nginx/nginx.conf

      # FIXME: #21 I should use "service" directive instead of "command"
      # but nginx does not start when I use "service" directive;
      # this requires investigation
    - name: nginx restarted
      command: service nginx restart

    - name: pip packages installed through tox
      pip:
        name="tox"
        state=latest

    - name: tox environment created
      shell: >
        tox -r -e {{ ansible_env.ENV_NAME }}
      args:
        chdir: "{{ ansible_env.APP_PATH }}"
        creates: "{{ ansible_env.VIRTUAL_ENV_PATH }}"

    - name: default folder and virtualenv activation enabled when ssh
      lineinfile:
        path: /home/vagrant/.zshrc
        line: "cd /vagrant && source /tmp/virtual_env35/bin/activate"
